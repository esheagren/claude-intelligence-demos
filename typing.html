<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 36px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #888;
            font-size: 16px;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            min-width: 120px;
        }

        .stat-value {
            font-size: 42px;
            font-weight: 700;
            color: #00d4ff;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-value.wpm {
            color: #00ff88;
        }

        .stat-value.accuracy {
            color: #ffd700;
        }

        .stat-value.time {
            color: #ff6b6b;
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        select, button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        select {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            min-width: 150px;
        }

        button {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        button.primary {
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            color: #000;
            font-weight: 600;
        }

        button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3);
        }

        .text-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 22px;
            line-height: 1.8;
            min-height: 200px;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: border-color 0.3s;
        }

        .text-display.active {
            border-color: rgba(0, 212, 255, 0.5);
        }

        .text-display.completed {
            border-color: rgba(0, 255, 136, 0.5);
        }

        .text-display.error {
            border-color: rgba(255, 107, 107, 0.5);
        }

        .char {
            position: relative;
            transition: color 0.1s;
        }

        .char.correct {
            color: #00ff88;
        }

        .char.incorrect {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.2);
            border-radius: 2px;
        }

        .char.current {
            background: rgba(0, 212, 255, 0.3);
            border-radius: 2px;
            animation: blink 1s infinite;
        }

        .char.untyped {
            color: rgba(255, 255, 255, 0.4);
        }

        @keyframes blink {
            0%, 50% { background: rgba(0, 212, 255, 0.3); }
            51%, 100% { background: rgba(0, 212, 255, 0.1); }
        }

        .input-area {
            position: relative;
        }

        #typingInput {
            width: 100%;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            outline: none;
            transition: border-color 0.3s;
        }

        #typingInput:focus {
            border-color: rgba(0, 212, 255, 0.5);
        }

        #typingInput::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            border-radius: 3px;
            transition: width 0.1s;
        }

        .results {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 16px;
            text-align: center;
        }

        .results.visible {
            display: block;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #00ff88;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
        }

        .result-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: #00d4ff;
        }

        .result-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .history {
            margin-top: 40px;
        }

        .history h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #888;
        }

        .history-list {
            display: grid;
            gap: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
        }

        .history-item .wpm {
            color: #00ff88;
            font-weight: 600;
        }

        .history-item .accuracy {
            color: #ffd700;
        }

        .history-item .date {
            color: #888;
            font-size: 12px;
        }

        .keyboard-hint {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #666;
        }

        .keyboard-hint kbd {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 0 2px;
        }

        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-tab.active {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .mode-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .live-wpm {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 14px;
            color: #888;
            font-family: 'JetBrains Mono', monospace;
        }

        .live-wpm span {
            color: #00ff88;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .stat-value {
                font-size: 32px;
            }

            .text-display {
                font-size: 18px;
                padding: 20px;
            }

            .stats-bar {
                gap: 15px;
            }

            .stat {
                min-width: 90px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Typing Speed Test</h1>
            <p class="subtitle">Test your typing speed and accuracy</p>
        </header>

        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value wpm" id="wpmDisplay">0</div>
                <div class="stat-label">WPM</div>
            </div>
            <div class="stat">
                <div class="stat-value accuracy" id="accuracyDisplay">100</div>
                <div class="stat-label">Accuracy %</div>
            </div>
            <div class="stat">
                <div class="stat-value time" id="timeDisplay">0</div>
                <div class="stat-label">Seconds</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="errorsDisplay">0</div>
                <div class="stat-label">Errors</div>
            </div>
        </div>

        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="quotes">Quotes</button>
            <button class="mode-tab" data-mode="words">Words</button>
            <button class="mode-tab" data-mode="code">Code</button>
            <button class="mode-tab" data-mode="numbers">Numbers</button>
        </div>

        <div class="controls">
            <select id="duration">
                <option value="30">30 seconds</option>
                <option value="60" selected>60 seconds</option>
                <option value="120">2 minutes</option>
                <option value="0">Unlimited</option>
            </select>
            <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
            </select>
            <button class="primary" id="startBtn">Start Test</button>
            <button id="resetBtn">Reset</button>
        </div>

        <div class="text-display" id="textDisplay">
            <div class="live-wpm" id="liveWpm" style="display: none;">
                Live: <span>0</span> WPM
            </div>
            <span class="placeholder">Click "Start Test" or press Enter to begin...</span>
        </div>

        <div class="input-area">
            <input type="text" id="typingInput" placeholder="Start typing here..." disabled autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="keyboard-hint">
            <kbd>Enter</kbd> to start/restart | <kbd>Esc</kbd> to reset | <kbd>Tab</kbd> to skip word
        </div>

        <div class="results" id="results">
            <h2>Test Complete!</h2>
            <div class="results-grid">
                <div class="result-item">
                    <div class="result-value" id="finalWpm">0</div>
                    <div class="result-label">Words Per Minute</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalAccuracy">0%</div>
                    <div class="result-label">Accuracy</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalChars">0</div>
                    <div class="result-label">Characters</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalErrors">0</div>
                    <div class="result-label">Errors</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalRaw">0</div>
                    <div class="result-label">Raw WPM</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalTime">0s</div>
                    <div class="result-label">Time</div>
                </div>
            </div>
            <button class="primary" id="tryAgainBtn">Try Again</button>
        </div>

        <div class="history" id="history">
            <h3>Recent Results</h3>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>

    <script>
        // Text content for different modes
        const texts = {
            quotes: {
                easy: [
                    "The only way to do great work is to love what you do.",
                    "In the middle of difficulty lies opportunity.",
                    "Life is what happens when you're busy making other plans.",
                    "The future belongs to those who believe in the beauty of their dreams.",
                    "It is during our darkest moments that we must focus to see the light.",
                    "Success is not final, failure is not fatal: it is the courage to continue that counts.",
                    "The best time to plant a tree was twenty years ago. The second best time is now.",
                    "Be yourself; everyone else is already taken."
                ],
                medium: [
                    "The greatest glory in living lies not in never falling, but in rising every time we fall.",
                    "Your time is limited, so don't waste it living someone else's life. Don't be trapped by dogma.",
                    "If you look at what you have in life, you'll always have more. If you look at what you don't have, you'll never have enough.",
                    "The only impossible journey is the one you never begin. Take the first step in faith.",
                    "Spread love everywhere you go. Let no one ever come to you without leaving happier.",
                    "When you reach the end of your rope, tie a knot in it and hang on with everything you've got."
                ],
                hard: [
                    "It is not the critic who counts; not the man who points out how the strong man stumbles, or where the doer of deeds could have done them better. The credit belongs to the man who is actually in the arena.",
                    "In the depth of winter, I finally learned that within me there lay an invincible summer. And that makes me happy. For it says that no matter how hard the world pushes against me, within me, there's something stronger.",
                    "Twenty years from now you will be more disappointed by the things that you didn't do than by the ones you did do. So throw off the bowlines. Sail away from the safe harbor. Catch the trade winds in your sails. Explore. Dream. Discover."
                ]
            },
            words: {
                easy: ["the", "be", "to", "of", "and", "a", "in", "that", "have", "I", "it", "for", "not", "on", "with", "he", "as", "you", "do", "at", "this", "but", "his", "by", "from", "they", "we", "say", "her", "she", "or", "an", "will", "my", "one", "all", "would", "there", "their", "what", "so", "up", "out", "if", "about", "who", "get", "which", "go", "me"],
                medium: ["people", "about", "could", "after", "first", "would", "other", "these", "their", "think", "which", "great", "being", "where", "those", "every", "never", "world", "still", "should", "through", "before", "might", "under", "while", "again", "found", "always", "right", "between", "change", "without", "different", "another", "together", "better", "something", "important", "become"],
                hard: ["algorithm", "philosophy", "architecture", "consciousness", "extraordinary", "implementation", "comprehensive", "infrastructure", "revolutionary", "sophisticated", "entrepreneurship", "psychological", "Mediterranean", "bibliographical", "circumstances", "electromagnetic", "responsibilities", "characteristics", "accomplishments", "telecommunications"]
            },
            code: {
                easy: [
                    "const x = 10;",
                    "let name = 'hello';",
                    "function add(a, b) { return a + b; }",
                    "if (x > 5) { console.log(x); }",
                    "for (let i = 0; i < 10; i++) { }",
                    "const arr = [1, 2, 3, 4, 5];",
                    "arr.map(x => x * 2);",
                    "const obj = { key: 'value' };"
                ],
                medium: [
                    "function fibonacci(n) { return n <= 1 ? n : fibonacci(n - 1) + fibonacci(n - 2); }",
                    "const sorted = arr.sort((a, b) => a - b);",
                    "async function fetchData(url) { const res = await fetch(url); return res.json(); }",
                    "class Rectangle { constructor(w, h) { this.width = w; this.height = h; } }",
                    "const unique = [...new Set(array)];",
                    "arr.filter(x => x % 2 === 0).reduce((a, b) => a + b, 0);"
                ],
                hard: [
                    "const debounce = (fn, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => fn.apply(this, args), delay); }; };",
                    "function* generatePrimes() { let n = 2; while (true) { if (isPrime(n)) yield n; n++; } }",
                    "const deepClone = (obj) => JSON.parse(JSON.stringify(obj));",
                    "Object.entries(obj).reduce((acc, [key, val]) => ({ ...acc, [key]: transform(val) }), {});"
                ]
            },
            numbers: {
                easy: [],
                medium: [],
                hard: []
            }
        };

        // Generate number sequences
        function generateNumbers(difficulty) {
            const count = difficulty === 'easy' ? 20 : difficulty === 'medium' ? 35 : 50;
            const maxDigits = difficulty === 'easy' ? 3 : difficulty === 'medium' ? 5 : 8;
            const numbers = [];

            for (let i = 0; i < count; i++) {
                const digits = Math.floor(Math.random() * maxDigits) + 1;
                const num = Math.floor(Math.random() * Math.pow(10, digits));
                numbers.push(num.toString());
            }

            return numbers.join(' ');
        }

        // State
        let currentMode = 'quotes';
        let currentDifficulty = 'medium';
        let currentDuration = 60;
        let targetText = '';
        let typedText = '';
        let startTime = null;
        let endTime = null;
        let timer = null;
        let isActive = false;
        let errors = 0;
        let correctChars = 0;
        let totalTyped = 0;
        let history = JSON.parse(localStorage.getItem('typingHistory') || '[]');

        // DOM elements
        const textDisplay = document.getElementById('textDisplay');
        const typingInput = document.getElementById('typingInput');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const tryAgainBtn = document.getElementById('tryAgainBtn');
        const resultsDiv = document.getElementById('results');
        const progressFill = document.getElementById('progressFill');
        const liveWpm = document.getElementById('liveWpm');

        function generateText() {
            if (currentMode === 'numbers') {
                return generateNumbers(currentDifficulty);
            }

            const textPool = texts[currentMode][currentDifficulty];
            if (currentMode === 'words') {
                const wordCount = currentDuration === 0 ? 100 : Math.ceil(currentDuration / 60 * 50);
                const words = [];
                for (let i = 0; i < wordCount; i++) {
                    words.push(textPool[Math.floor(Math.random() * textPool.length)]);
                }
                return words.join(' ');
            } else {
                // For quotes and code, concatenate multiple if needed
                const shuffled = [...textPool].sort(() => Math.random() - 0.5);
                let result = shuffled[0];
                let i = 1;
                while (result.length < 200 && i < shuffled.length) {
                    result += ' ' + shuffled[i];
                    i++;
                }
                return result;
            }
        }

        function renderText() {
            if (!targetText) {
                textDisplay.innerHTML = '<span class="placeholder">Click "Start Test" or press Enter to begin...</span>';
                return;
            }

            let html = '';
            for (let i = 0; i < targetText.length; i++) {
                let className = 'char ';
                if (i < typedText.length) {
                    className += typedText[i] === targetText[i] ? 'correct' : 'incorrect';
                } else if (i === typedText.length) {
                    className += 'current';
                } else {
                    className += 'untyped';
                }

                let char = targetText[i];
                if (char === ' ') char = '&nbsp;';
                html += `<span class="${className}">${char}</span>`;
            }

            const liveWpmHtml = isActive ? `<div class="live-wpm">Live: <span>${calculateWpm()}</span> WPM</div>` : '';
            textDisplay.innerHTML = liveWpmHtml + html;
        }

        function calculateWpm() {
            if (!startTime) return 0;
            const elapsed = (Date.now() - startTime) / 1000 / 60; // minutes
            if (elapsed === 0) return 0;
            const words = correctChars / 5; // Standard: 5 chars = 1 word
            return Math.round(words / elapsed);
        }

        function calculateRawWpm() {
            if (!startTime) return 0;
            const elapsed = (Date.now() - startTime) / 1000 / 60;
            if (elapsed === 0) return 0;
            const words = totalTyped / 5;
            return Math.round(words / elapsed);
        }

        function calculateAccuracy() {
            if (totalTyped === 0) return 100;
            return Math.round((correctChars / totalTyped) * 100);
        }

        function updateStats() {
            document.getElementById('wpmDisplay').textContent = calculateWpm();
            document.getElementById('accuracyDisplay').textContent = calculateAccuracy();
            document.getElementById('errorsDisplay').textContent = errors;

            if (startTime) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('timeDisplay').textContent = elapsed;

                if (currentDuration > 0) {
                    const progress = Math.min((elapsed / currentDuration) * 100, 100);
                    progressFill.style.width = progress + '%';
                } else {
                    const textProgress = (typedText.length / targetText.length) * 100;
                    progressFill.style.width = textProgress + '%';
                }
            }
        }

        function startTest() {
            targetText = generateText();
            typedText = '';
            errors = 0;
            correctChars = 0;
            totalTyped = 0;
            startTime = null;
            endTime = null;

            textDisplay.classList.add('active');
            textDisplay.classList.remove('completed', 'error');
            resultsDiv.classList.remove('visible');
            typingInput.disabled = false;
            typingInput.value = '';
            typingInput.focus();
            progressFill.style.width = '0%';

            isActive = true;
            renderText();
            updateStats();

            startBtn.textContent = 'Restart';
        }

        function endTest() {
            isActive = false;
            endTime = Date.now();

            if (timer) {
                clearInterval(timer);
                timer = null;
            }

            textDisplay.classList.remove('active');
            textDisplay.classList.add('completed');
            typingInput.disabled = true;

            const elapsed = (endTime - startTime) / 1000;
            const wpm = calculateWpm();
            const accuracy = calculateAccuracy();
            const rawWpm = calculateRawWpm();

            document.getElementById('finalWpm').textContent = wpm;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            document.getElementById('finalChars').textContent = correctChars;
            document.getElementById('finalErrors').textContent = errors;
            document.getElementById('finalRaw').textContent = rawWpm;
            document.getElementById('finalTime').textContent = Math.round(elapsed) + 's';

            resultsDiv.classList.add('visible');

            // Save to history
            const result = {
                wpm,
                accuracy,
                mode: currentMode,
                difficulty: currentDifficulty,
                date: new Date().toLocaleDateString(),
                chars: correctChars,
                errors
            };

            history.unshift(result);
            if (history.length > 10) history.pop();
            localStorage.setItem('typingHistory', JSON.stringify(history));
            renderHistory();

            startBtn.textContent = 'Start Test';
        }

        function reset() {
            isActive = false;
            if (timer) {
                clearInterval(timer);
                timer = null;
            }

            targetText = '';
            typedText = '';
            errors = 0;
            correctChars = 0;
            totalTyped = 0;
            startTime = null;
            endTime = null;

            textDisplay.classList.remove('active', 'completed', 'error');
            resultsDiv.classList.remove('visible');
            typingInput.disabled = true;
            typingInput.value = '';
            progressFill.style.width = '0%';

            document.getElementById('wpmDisplay').textContent = '0';
            document.getElementById('accuracyDisplay').textContent = '100';
            document.getElementById('timeDisplay').textContent = '0';
            document.getElementById('errorsDisplay').textContent = '0';

            renderText();
            startBtn.textContent = 'Start Test';
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">No results yet</div>';
                return;
            }

            list.innerHTML = history.map(item => `
                <div class="history-item">
                    <span class="wpm">${item.wpm} WPM</span>
                    <span class="accuracy">${item.accuracy}%</span>
                    <span>${item.mode} / ${item.difficulty}</span>
                    <span class="date">${item.date}</span>
                </div>
            `).join('');
        }

        // Event listeners
        typingInput.addEventListener('input', (e) => {
            if (!isActive) return;

            const newText = e.target.value;
            const lastChar = newText[newText.length - 1];

            if (!startTime) {
                startTime = Date.now();
                if (currentDuration > 0) {
                    timer = setInterval(() => {
                        updateStats();
                        renderText();
                        const elapsed = (Date.now() - startTime) / 1000;
                        if (elapsed >= currentDuration) {
                            endTest();
                        }
                    }, 100);
                } else {
                    timer = setInterval(() => {
                        updateStats();
                        renderText();
                    }, 100);
                }
            }

            // Track typing
            if (newText.length > typedText.length) {
                // Character added
                totalTyped++;
                const targetChar = targetText[typedText.length];
                if (lastChar === targetChar) {
                    correctChars++;
                } else {
                    errors++;
                    textDisplay.classList.add('error');
                    setTimeout(() => textDisplay.classList.remove('error'), 100);
                }
            }

            typedText = newText;
            renderText();

            // Check if completed
            if (typedText.length >= targetText.length) {
                endTest();
            }
        });

        typingInput.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                // Skip to next word
                if (isActive && typedText.length < targetText.length) {
                    const remaining = targetText.slice(typedText.length);
                    const nextSpace = remaining.indexOf(' ');
                    if (nextSpace > 0) {
                        const skipTo = typedText.length + nextSpace + 1;
                        typedText = targetText.slice(0, skipTo);
                        typingInput.value = typedText;
                        renderText();
                    }
                }
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && document.activeElement !== typingInput) {
                e.preventDefault();
                startTest();
            } else if (e.key === 'Escape') {
                reset();
            }
        });

        startBtn.addEventListener('click', startTest);
        resetBtn.addEventListener('click', reset);
        tryAgainBtn.addEventListener('click', startTest);

        document.querySelectorAll('.mode-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentMode = tab.dataset.mode;
                if (isActive) reset();
            });
        });

        document.getElementById('duration').addEventListener('change', (e) => {
            currentDuration = parseInt(e.target.value);
            if (isActive) reset();
        });

        document.getElementById('difficulty').addEventListener('change', (e) => {
            currentDifficulty = e.target.value;
            if (isActive) reset();
        });

        // Initialize
        renderText();
        renderHistory();
    </script>
</body>
</html>
